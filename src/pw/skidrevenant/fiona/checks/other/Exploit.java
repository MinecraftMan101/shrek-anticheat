package pw.skidrevenant.fiona.checks.other;

import org.bukkit.Material;
import org.bukkit.enchantments.Enchantment;
import org.bukkit.entity.Player;
import org.bukkit.event.Event;
import org.bukkit.event.player.PlayerInteractEvent;
import org.bukkit.inventory.ItemStack;

import pw.skidrevenant.fiona.Fiona;
import pw.skidrevenant.fiona.detections.Checks;
import pw.skidrevenant.fiona.detections.ChecksListener;
import pw.skidrevenant.fiona.detections.ChecksType;
import pw.skidrevenant.fiona.user.User;

@ChecksListener(events = { PlayerInteractEvent.class })
public class Exploit extends Checks
{
    public Exploit() {
        super("Exploit", ChecksType.OTHER, Fiona.getAC(), 1, true, false);
    }
    
    @Override
    protected void onEvent(final Event event) {
        if (!this.getState()) {
            return;
        }
        if (event instanceof PlayerInteractEvent) {
            final PlayerInteractEvent e = (PlayerInteractEvent)event;
            final Player attacker = e.getPlayer();
            if (attacker.isOp()) {
                return;
            }
            final ItemStack is = e.getItem();
            if (is == null) {
                return;
            }
            if (is.getType() != Material.BOOK_AND_QUILL && is.getType() != Material.WRITTEN_BOOK) {
                return;
            }
            if (is.getEnchantments().size() > 0) {
                for (final Enchantment ench : is.getEnchantments().keySet()) {
                    is.removeEnchantment(ench);
                }
                e.setCancelled(true);
                attacker.getInventory().removeItem(new ItemStack[] { is });
                final User user = Fiona.getUserManager().getUser(attacker.getUniqueId());
                user.setVL(this, user.getVL(this) + 1);
                this.Alert(attacker, "Book and Quill");
            }
        }
    }
}
